<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jet Fighters: Nations at War</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

  body, html {
    margin: 0; padding: 0; height: 100%;
    background: radial-gradient(circle at center, #070a2a, #000010);
    font-family: 'Orbitron', monospace;
    color: #aafcff;
    user-select: none;
    overflow: hidden;
  }

  /* PARTICLES BACKGROUND */
  #particles {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 0;
  }

  /* MAIN MENU */
  #main-menu {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    gap: 20px;
    padding: 0 20px;
    background:
      radial-gradient(circle at center, #0ff3 30%, transparent 80%);
    position: relative;
    z-index: 1;
  }

  #main-menu h1 {
    font-size: 4rem;
    text-shadow:
      0 0 5px #00ffffaa,
      0 0 15px #00ffffcc,
      0 0 30px #00ffffff;
    animation: flicker 2.5s infinite alternate;
    margin-bottom: 5px;
  }

  @keyframes flicker {
    0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
      opacity: 1;
      text-shadow:
        0 0 5px #00ffffaa,
        0 0 15px #00ffffcc,
        0 0 30px #00ffffff;
    }
    20%, 22%, 24%, 55% {
      opacity: 0.7;
      text-shadow: none;
    }
  }

  #main-menu .subtitle {
    font-size: 1.3rem;
    color: #55eeffcc;
    margin-bottom: 40px;
    letter-spacing: 0.08em;
    user-select:none;
  }

  .nation-button {
    background: linear-gradient(135deg, #004466, #002233);
    border: 3px solid #00ffff;
    border-radius: 16px;
    color: #aaffff;
    font-size: 1.6rem;
    padding: 18px 50px;
    width: 320px;
    cursor: pointer;
    text-align: center;
    text-shadow: 0 0 6px #00ffffcc;
    box-shadow: 0 0 15px #00ffff88;
    transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
    user-select:none;
    position: relative;
    overflow: hidden;
  }
  .nation-button:hover, .nation-button:focus {
    transform: scale(1.1);
    box-shadow: 0 0 40px #00ffffcc;
    background: linear-gradient(135deg, #0077aa, #004466);
    outline: none;
  }

  /* FOOTER */
  #footer {
    position: fixed;
    bottom: 10px;
    width: 100%;
    text-align: center;
    font-size: 0.9rem;
    color: #008899cc;
    letter-spacing: 0.1em;
    user-select:none;
    text-shadow: 0 0 5px #00cccc88;
    z-index: 1;
  }

  /* INTERMEDIATE SELECTION SCREEN */
  #post-nation-select {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    gap: 30px;
    background:
      radial-gradient(circle at center, #070a2a, #000010);
    z-index: 2;
    position: relative;
  }
  #post-nation-select.active {
    display: flex;
  }
  #post-nation-select h2 {
    font-size: 3rem;
    color: #00ffff;
    text-shadow: 0 0 15px #00ffffcc;
    user-select: none;
  }
  .choice-button {
    background: linear-gradient(135deg, #004466, #002233);
    border: 3px solid #00ffff;
    border-radius: 20px;
    color: #aaffff;
    font-size: 2rem;
    padding: 20px 60px;
    cursor: pointer;
    text-shadow: 0 0 6px #00ffffcc;
    box-shadow: 0 0 25px #00ffff88;
    transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
    user-select:none;
    width: 320px;
    text-align: center;
  }
  .choice-button:hover, .choice-button:focus {
    transform: scale(1.1);
    box-shadow: 0 0 60px #00ffffcc;
    background: linear-gradient(135deg, #0077aa, #004466);
    outline: none;
  }

  /* TECH TREE SCREEN */
  #tech-tree-screen {
    display: none;
    flex-direction: column;
    height: 100vh;
    background: radial-gradient(circle at center, #070a2a, #000010);
    user-select: none;
  }
  #tech-tree-screen.active {
    display: flex;
  }
  #back-button {
    align-self: flex-start;
    margin: 15px 30px;
    background: linear-gradient(135deg, #004466, #002233);
    border: 3px solid #00ffff;
    border-radius: 12px;
    color: #aaffff;
    font-size: 1.2rem;
    padding: 10px 24px;
    cursor: pointer;
    box-shadow: 0 0 15px #00ffff88;
    user-select:none;
  }
  #back-button:hover, #back-button:focus {
    box-shadow: 0 0 30px #00ffffcc;
    outline: none;
    transform: scale(1.05);
  }
  #tech-tree-title {
    text-align: center;
    font-size: 2.5rem;
    margin: 10px 0 20px;
    color: #00ffff;
    text-shadow: 0 0 12px #00ffffcc;
    user-select:none;
  }
  .tree-wrapper {
    flex-grow: 1;
    margin: 0 30px 30px;
    overflow: auto;
    cursor: grab;
    background:
      linear-gradient(to right, rgba(0, 255, 255, 0.07) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(0, 255, 255, 0.07) 1px, transparent 1px);
    background-size: 80px 80px;
    position: relative;
    box-shadow: inset 0 0 40px #00ffff33;
    border-radius: 20px;
    border: 1px solid #00ffff44;
  }
  .tech-tree {
    position: relative;
    width: 1400px;
    height: 480px;
    margin: 0 auto;
    user-select: none;
  }
  .node {
    position: absolute;
    background: rgba(0, 255, 255, 0.12);
    border: 2px solid #00ffffcc;
    padding: 10px 14px;
    border-radius: 14px;
    width: 150px;
    height: 130px;
    text-align: center;
    font-weight: 700;
    font-family: 'Orbitron', monospace;
    letter-spacing: 0.05em;
    color: #aaffff;
    box-shadow: 0 0 15px #00ffffbb;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  .node:hover, .node:focus {
    transform: scale(1.15);
    box-shadow: 0 0 35px #00ffffee;
    outline: none;
    z-index: 10;
  }
  .node img {
    width: 100%;
    height: 70px;
    object-fit: contain;
    margin-bottom: 10px;
    pointer-events: none;
  }

  svg#lines path {
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-width: 3;
    stroke: #00ffffcc;
  }

  .tooltip {
    position: absolute;
    background: rgba(0, 255, 255, 0.22);
    backdrop-filter: blur(8px);
    color: #00ffff;
    padding: 8px 14px;
    border-radius: 12px;
    font-size: 0.9rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    white-space: nowrap;
    z-index: 20;
    font-family: 'Orbitron', monospace;
    text-shadow: 0 0 8px #00ffffcc;
  }

  /* JET SELECTION SCREEN */
  #jet-select-screen {
    display: none;
    flex-direction: column;
    height: 100vh;
    background: radial-gradient(circle at center, #070a2a, #000010);
    user-select: none;
    align-items: center;
    padding: 20px;
    overflow-y: auto;
    gap: 25px;
    z-index: 3;
  }
  #jet-select-screen.active {
    display: flex;
  }
  #jet-select-title {
    font-size: 3rem;
    color: #00ffff;
    text-shadow: 0 0 15px #00ffffcc;
    user-select: none;
    margin-bottom: 10px;
  }
  .jet-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 30px;
    max-width: 1000px;
  }
  .jet-card {
    background: rgba(0, 255, 255, 0.12);
    border: 2px solid #00ffffcc;
    border-radius: 20px;
    width: 200px;
    height: 260px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 0 15px #00ffffbb;
    cursor: pointer;
    transition: transform 0.25s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .jet-card:hover, .jet-card:focus {
    transform: scale(1.1);
    box-shadow: 0 0 40px #00ffffee;
    outline: none;
    z-index: 20;
  }
  .jet-card img {
    width: 100%;
    height: 140px;
    object-fit: contain;
    pointer-events: none;
    border-radius: 14px;
    user-select:none;
  }
  .jet-card .jet-name {
    font-weight: 700;
    font-family: 'Orbitron', monospace;
    letter-spacing: 0.07em;
    color: #aaffff;
    font-size: 1.3rem;
  }
  .jet-card .jet-info {
    font-size: 1rem;
    color: #00cccc;
  }
</style>
</head>
<body>

  <!-- PARTICLES CANVAS -->
  <canvas id="particles"></canvas>

  <!-- MAIN MENU -->
  <section id="main-menu" role="main" aria-label="Nation selection screen">
    <h1>Jet Fighters: Nations at War</h1>
    <div class="subtitle">Choose your nation and dominate the skies!</div>
    <button class="nation-button" data-nation="usa" tabindex="0">ðŸ‡ºðŸ‡¸ United States</button>
    <button class="nation-button" data-nation="russia" tabindex="0">ðŸ‡·ðŸ‡º Russia</button>
    <button class="nation-button" data-nation="uk" tabindex="0">ðŸ‡¬ðŸ‡§ United Kingdom</button>
    <button class="nation-button" data-nation="china" tabindex="0">ðŸ‡¨ðŸ‡³ China</button>
  </section>

  <!-- INTERMEDIATE SELECTION SCREEN -->
  <section id="post-nation-select" role="dialog" aria-modal="true" aria-label="Select action">
    <h2 id="selected-nation-title"></h2>
    <button class="choice-button" id="view-tech-tree">View Tech Tree</button>
    <button class="choice-button" id="jet-selection">Jet Selection</button>
    <button class="choice-button" id="play-game">Play Game</button>
  </section>

  <!-- TECH TREE SCREEN -->
  <section id="tech-tree-screen" aria-label="Tech tree screen">
    <button id="back-button" aria-label="Return to nation selection menu">â¬… Back</button>
    <h2 id="tech-tree-title">Tech Tree</h2>
    <div class="tree-wrapper" id="tree-wrapper" tabindex="0" aria-describedby="tooltip">
      <div class="tech-tree" id="tree-container">
        <svg id="lines" width="1400" height="480" aria-hidden="true"></svg>
      </div>
      <div class="tooltip" id="tooltip" role="tooltip"></div>
    </div>
  </section>

  <!-- JET SELECTION SCREEN -->
  <section id="jet-select-screen" aria-label="Select jet to fly">
    <h2 id="jet-select-title">Select Your Jet</h2>
    <div class="jet-list" id="jet-list">
      <!-- Jets will be dynamically inserted here -->
    </div>
  </section>

  <!-- FOOTER -->
  <div id="footer">Â© 2025 Jet Fighters Game | All rights reserved</div>

<script>
  // Particle background effect for main menu
  const canvas = document.getElementById('particles');
  const ctx = canvas.getContext('2d');
  let width, height;
  let particles = [];

  function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  class Particle {
    constructor() {
      this.x = Math.random() * width;
      this.y = Math.random() * height;
      this.radius = Math.random() * 1.5 + 0.5;
      this.speedX = (Math.random() - 0.5) * 0.3;
      this.speedY = (Math.random() - 0.5) * 0.3;
      this.alpha = Math.random() * 0.8 + 0.2;
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      if (this.x < 0) this.x = width;
      else if (this.x > width) this.x = 0;
      if (this.y < 0) this.y = height;
      else if (this.y > height) this.y = 0;
    }
    draw() {
      ctx.beginPath();
      ctx.fillStyle = `rgba(0, 255, 255, ${this.alpha})`;
      ctx.shadowColor = 'cyan';
      ctx.shadowBlur = 4;
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  for (let i = 0; i < 180; i++) particles.push(new Particle());

  function animate() {
    ctx.clearRect(0, 0, width, height);
    for (let p of particles) {
      p.update();
      p.draw();
    }
    requestAnimationFrame(animate);
  }
  animate();

  // ----- GAME UI LOGIC -----
  const mainMenu = document.getElementById('main-menu');
  const postNationScreen = document.getElementById('post-nation-select');
  const techTreeScreen = document.getElementById('tech-tree-screen');
  const jetSelectScreen = document.getElementById('jet-select-screen');
  const selectedNationTitle = document.getElementById('selected-nation-title');
  const viewTechTreeBtn = document.getElementById('view-tech-tree');
  const jetSelectionBtn = document.getElementById('jet-selection');
  const playGameBtn = document.getElementById('play-game');
  const backButton = document.getElementById('back-button');

  const treeContainer = document.getElementById('tree-container');
  const linesSVG = document.getElementById('lines');
  const tooltip = document.getElementById('tooltip');
  const treeWrapper = document.getElementById('tree-wrapper');

  const jetList = document.getElementById('jet-list');

  let selectedNation = null;

  // Nation buttons click
  document.querySelectorAll('.nation-button').forEach(btn => {
    btn.addEventListener('click', () => {
      selectedNation = btn.dataset.nation;
      selectedNationTitle.textContent = `Selected Nation: ${btn.textContent}`;
      mainMenu.style.display = 'none';
      postNationScreen.classList.add('active');
    });
  });

  // Back button to main menu from tech tree
  backButton.addEventListener('click', () => {
    techTreeScreen.classList.remove('active');
    postNationScreen.classList.add('active');
  });

  // View Tech Tree click
  viewTechTreeBtn.addEventListener('click', () => {
    postNationScreen.classList.remove('active');
    techTreeScreen.classList.add('active');
    buildTechTree(selectedNation);
    document.getElementById('tech-tree-title').textContent = `${capitalize(selectedNation)} Tech Tree`;
  });

  // Jet Selection click
  jetSelectionBtn.addEventListener('click', () => {
    postNationScreen.classList.remove('active');
    showJetSelectScreen(selectedNation);
  });

  // Play Game click - For now, just alert and back to main menu
  playGameBtn.addEventListener('click', () => {
    alert(`Starting game for ${capitalize(selectedNation)}!`);
    postNationScreen.classList.remove('active');
    mainMenu.style.display = 'flex';
  });

  // Show jet select screen
  function showJetSelectScreen(nation) {
    jetList.innerHTML = '';
    jetSelectScreen.classList.add('active');
    document.getElementById('jet-select-title').textContent = `Select Your Jet - ${capitalize(nation)}`;

    const jets = jetsByNation[nation] || [];
    jets.forEach(jet => {
      const card = document.createElement('div');
      card.classList.add('jet-card');
      card.tabIndex = 0;
      card.setAttribute('aria-label', `${jet.name} - ${jet.description}`);

      const img = document.createElement('img');
      img.src = jet.img;
      img.alt = jet.name;

      const name = document.createElement('div');
      name.className = 'jet-name';
      name.textContent = jet.name;

      const desc = document.createElement('div');
      desc.className = 'jet-info';
      desc.textContent = jet.description;

      card.appendChild(img);
      card.appendChild(name);
      card.appendChild(desc);

      card.addEventListener('click', () => selectJet(jet));
      card.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          selectJet(jet);
        }
      });

      jetList.appendChild(card);
    });
  }

  // Handle jet selection
  function selectJet(jet) {
    alert(`You selected the jet: ${jet.name}\n\nDescription: ${jet.description}`);
    // For now, just alert - later replace with game start logic
    jetSelectScreen.classList.remove('active');
    mainMenu.style.display = 'flex';
  }

  // Capitalize helper
  function capitalize(str) {
    if (!str) return '';
    return str.charAt(0).toUpperCase() + str.slice(1);
  }

  // TECH TREE DATA
  const techTrees = {
    usa: [
      { id: "fa18", name: "F/A-18 Hornet", x: 50, y: 120, tooltip: "Multirole Fighter", img: "fa18.png", cost: 0, connections: ["fa22", "aim120"] },
      { id: "fa22", name: "F-22 Raptor", x: 250, y: 40, tooltip: "Stealth Air Superiority Fighter", img: "fa22.png", cost: 100000, connections: ["b2", "aim260"] },
      { id: "aim120", name: "AIM-120 Missile", x: 250, y: 200, tooltip: "Advanced Medium-Range Missile", cost: 15000, connections: ["jdam"] },
      { id: "b2", name: "B-2 Bomber", x: 450, y: 120, tooltip: "Stealth Bomber", img: "b2.png", cost: 300000, connections: ["tomahawk"] },
      { id: "jdam", name: "JDAM Bomb", x: 450, y: 200, tooltip: "Guided Bomb", cost: 5000, connections: [] },
      { id: "aim260", name: "AIM-260 Missile", x: 650, y: 40, tooltip: "Next-gen air-to-air missile", cost: 20000, connections: [] },
      { id: "tomahawk", name: "Tomahawk Missile", x: 650, y: 120, tooltip: "Long-range cruise missile", cost: 80000, connections: [] }
    ],
    russia: [
      { id: "su57", name: "Su-57 Felon", x: 50, y: 120, tooltip: "Stealth Multirole Fighter", img: "su57.png", cost: 0, connections: ["kh59", "sm6"] },
      { id: "kh59", name: "Kh-59 Missile", x: 250, y: 40, tooltip: "Long-range cruise missile", cost: 18000, connections: [] },
      { id: "sm6", name: "S-400 Missile", x: 250, y: 200, tooltip: "Surface-to-air missile", cost: 25000, connections: ["su35"] },
      { id: "su35", name: "Su-35 Flanker-E", x: 450, y: 120, tooltip: "Advanced Fighter", img: "su35.png", cost: 150000, connections: ["kh31", "r73"] },
      { id: "kh31", name: "Kh-31 Missile", x: 650, y: 40, tooltip: "Anti-radiation missile", cost: 40000, connections: [] },
      { id: "r73", name: "R-73 Missile", x: 650, y: 200, tooltip: "Short-range missile", cost: 15000, connections: ["tu160"] },
      { id: "tu160", name: "Tu-160 Blackjack", x: 850, y: 120, tooltip: "Strategic Bomber", img: "tu160.png", cost: 250000, connections: ["kh59"] },
      { id: "isands", name: "Iskander Missile", x: 1050, y: 120, tooltip: "Tactical ballistic missile", cost: 120000, connections: [] }
    ],
    uk: [
      { id: "tornado", name: "Tornado GR4", x: 50, y: 120, tooltip: "Ground Attack Aircraft", img: "tornado.png", cost: 0, connections: ["stormshadow", "paveway"] },
      { id: "stormshadow", name: "Storm Shadow", x: 250, y: 40, tooltip: "Long-range cruise missile", cost: 40000, connections: [] },
      { id: "paveway", name: "Paveway Laser", x: 250, y: 200, tooltip: "Laser-guided bomb", cost: 30000, connections: ["typhoonuk"] },
      { id: "typhoonuk", name: "Eurofighter Typhoon", x: 450, y: 120, tooltip: "Multirole Fighter Jet", img: "typhoonuk.png", cost: 150000, connections: ["meteor"] },
      { id: "meteor", name: "Meteor Missile", x: 650, y: 80, tooltip: "Beyond visual range missile", cost: 60000, connections: [] },
      { id: "brimstone", name: "Brimstone Missile", x: 650, y: 160, tooltip: "Air-to-ground missile", cost: 35000, connections: ["t45"] },
      { id: "t45", name: "BAE Hawk T1", x: 850, y: 120, tooltip: "Trainer and light attack aircraft", img: "t45.png", cost: 40000, connections: [] }
    ],
    china: [
      { id: "j20", name: "Chengdu J-20", x: 50, y: 120, tooltip: "Stealth Fighter", img: "j20.png", cost: 0, connections: ["pl10", "yd12"] },
      { id: "pl10", name: "PL-10 Missile", x: 250, y: 40, tooltip: "Short-range missile", cost: 30000, connections: [] },
      { id: "yd12", name: "YJ-12 Missile", x: 250, y: 200, tooltip: "Supersonic anti-ship missile", cost: 40000, connections: ["j31"] },
      { id: "j31", name: "Shenyang J-31", x: 450, y: 120, tooltip: "Stealth Multirole Fighter", img: "j31.png", cost: 130000, connections: ["pl15"] },
      { id: "pl15", name: "PL-15 Missile", x: 650, y: 80, tooltip: "Long-range missile", cost: 50000, connections: [] },
      { id: "hq9", name: "HQ-9 SAM", x: 650, y: 160, tooltip: "Surface-to-air missile system", cost: 35000, connections: [] }
    ]
  };

  // Jets by nation for jet select screen
  const jetsByNation = {
    usa: [
      { name: "F/A-18 Hornet", description: "Multirole fighter jet", img: "fa18.png" },
      { name: "F-22 Raptor", description: "Stealth air superiority fighter", img: "fa22.png" },
      { name: "B-2 Spirit", description: "Stealth bomber", img: "b2.png" }
    ],
    russia: [
      { name: "Su-57 Felon", description: "Stealth multirole fighter", img: "su57.png" },
      { name: "Su-35 Flanker-E", description: "Advanced fighter", img: "su35.png" },
      { name: "Tu-160 Blackjack", description: "Strategic bomber", img: "tu160.png" }
    ],
    uk: [
      { name: "Tornado GR4", description: "Ground attack aircraft", img: "tornado.png" },
      { name: "Eurofighter Typhoon", description: "Multirole fighter jet", img: "typhoonuk.png" },
      { name: "BAE Hawk T1", description: "Trainer and light attack aircraft", img: "t45.png" }
    ],
    china: [
      { name: "Chengdu J-20", description: "Stealth fighter", img: "j20.png" },
      { name: "Shenyang J-31", description: "Stealth multirole fighter", img: "j31.png" },
      { name: "Chengdu J-10", description: "Light multirole fighter", img: "j10.png" }
    ]
  };

  // Clear tech tree nodes and lines
  function clearTechTree() {
    treeContainer.innerHTML = '';
    while (linesSVG.firstChild) {
      linesSVG.removeChild(linesSVG.firstChild);
    }
    linesSVG.appendChild(marker); // re-add arrowhead marker
  }

  // Build Tech Tree Nodes and Connections
  function buildTechTree(nation) {
    clearTechTree();
    const data = techTrees[nation];
    if (!data) return;

    data.forEach(node => {
      const div = document.createElement('div');
      div.classList.add('node');
      div.setAttribute('tabindex', '0');
      div.style.left = node.x + 'px';
      div.style.top = node.y + 'px';
      div.setAttribute('data-tooltip', node.tooltip);
      div.setAttribute('data-id', node.id);

      if (node.img) {
        const img = document.createElement('img');
        img.src = node.img;
        img.alt = node.name + " image";
        div.appendChild(img);
      }

      const title = document.createElement('div');
      title.textContent = node.name;
      div.appendChild(title);

      div.addEventListener('click', () => openModal(node));
      div.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openModal(node);
        }
      });

      div.addEventListener('mouseenter', showTooltip);
      div.addEventListener('mouseleave', hideTooltip);
      div.addEventListener('focus', showTooltip);
      div.addEventListener('blur', hideTooltip);

      treeContainer.appendChild(div);
    });

    data.forEach(node => {
      node.connections.forEach(connId => {
        const fromNode = data.find(n => n.id === node.id);
        const toNode = data.find(n => n.id === connId);
        if (fromNode && toNode) drawLine(fromNode, toNode);
      });
    });
  }

  // Draw straight lines with arrowhead
  function drawLine(fromNode, toNode) {
    const startX = fromNode.x + 150; // right edge of node
    const startY = fromNode.y + 65;  // vertical center
    const endX = toNode.x;            // left edge of node
    const endY = toNode.y + 65;

    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    const d = `M${startX},${startY} L${endX},${endY}`;
    path.setAttribute("d", d);
    path.setAttribute("stroke", "#00ffffcc");
    path.setAttribute("stroke-width", "3");
    path.setAttribute("fill", "none");
    path.setAttribute("marker-end", "url(#arrowhead)");

    linesSVG.appendChild(path);
  }

  function showTooltip(e) {
    const node = e.currentTarget;
    tooltip.textContent = node.getAttribute('data-tooltip');
    const rect = node.getBoundingClientRect();
    const wrapperRect = treeWrapper.getBoundingClientRect();

    let top = rect.top - wrapperRect.top + window.scrollY - 40;
    let left = rect.left - wrapperRect.left + window.scrollX + rect.width / 2;

    if (left + tooltip.offsetWidth / 2 > wrapperRect.width) {
      left = wrapperRect.width - tooltip.offsetWidth / 2 - 10;
    }
    if (left - tooltip.offsetWidth / 2 < 0) {
      left = tooltip.offsetWidth / 2 + 10;
    }

    tooltip.style.top = `${top}px`;
    tooltip.style.left = `${left}px`;
    tooltip.style.opacity = '1';
  }
  function hideTooltip() {
    tooltip.style.opacity = '0';
  }

  function openModal(node) {
    alert(`You clicked on: ${node.name}\n\n${node.tooltip}\nCost: $${node.cost.toLocaleString()}`);
  }

  // Drag to pan tech tree
  let isDragging = false;
  let dragStartX, dragStartY, scrollStartX, scrollStartY;

  treeWrapper.addEventListener('mousedown', e => {
    isDragging = true;
    dragStartX = e.clientX;
    dragStartY = e.clientY;
    scrollStartX = treeWrapper.scrollLeft;
    scrollStartY = treeWrapper.scrollTop;
    treeWrapper.style.cursor = 'grabbing';
  });
  window.addEventListener('mouseup', () => {
    isDragging = false;
    treeWrapper.style.cursor = 'grab';
  });
  treeWrapper.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = e.clientX - dragStartX;
    const dy = e.clientY - dragStartY;
    treeWrapper.scrollLeft = scrollStartX - dx;
    treeWrapper.scrollTop = scrollStartY - dy;
  });

  // Add arrowhead marker to SVG for connections
  const svgNS = "http://www.w3.org/2000/svg";
  const marker = document.createElementNS(svgNS, "marker");
  marker.setAttribute("id", "arrowhead");
  marker.setAttribute("markerWidth", "10");
  marker.setAttribute("markerHeight", "7");
  marker.setAttribute("refX", "0");
  marker.setAttribute("refY", "3.5");
  marker.setAttribute("orient", "auto");
  const pathMarker = document.createElementNS(svgNS, "path");
  pathMarker.setAttribute("d", "M0,0 L0,7 L10,3.5 Z");
  pathMarker.setAttribute("fill", "#00ffffcc");
  marker.appendChild(pathMarker);
  linesSVG.appendChild(marker);
</script>

</body>
</html>
